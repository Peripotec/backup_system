{% extends "base.html" %}
{% block title %}Historial de Cambios - {{ hostname }}{% endblock %}

{% block head %}
<style>
    .diff-content {
        font-family: monospace;
        font-size: 12px;
        background: #0d1117;
        color: #d4d4d4;
        white-space: pre-wrap;
    }

    .diff-add {
        color: #4ec9b0;
        background: #1e3a2f;
    }

    .diff-del {
        color: #f48771;
        background: #3a1e1e;
    }

    .diff-header {
        color: #569cd6;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <i class="bi bi-file-diff"></i> Historial de Cambios: <strong>{{ hostname }}</strong> ({{ vendor }})
    </div>
    <div class="card-body">
        <pre class="diff-content p-3 rounded" id="diff-content"
            style="max-height: 600px; overflow: auto;">Cargando diff...</pre>
    </div>
</div>

<div class="mt-3">
    <a href="/" class="btn btn-secondary">‚Üê Volver al Dashboard</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    fetch('/api/diff/{{ vendor }}/{{ hostname }}')
        .then(r => r.json())
        .then(data => {
            let content = data.diff || data.error || 'Sin cambios registrados';
            content = content
                .replace(/^(\+.*)$/gm, '<span class="diff-add">$1</span>')
                .replace(/^(-.*)$/gm, '<span class="diff-del">$1</span>')
                .replace(/^(@@.*)$/gm, '<span class="diff-header">$1</span>')
                .replace(/^(commit .*)$/gm, '<span class="diff-header">$1</span>');
            document.getElementById('diff-content').innerHTML = content;
        });
</script>
{% endblock %}